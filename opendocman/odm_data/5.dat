<?/******************************************************************************Epiware: Project and Document Managementhttp://www.epiware.comCopyright (C) 2006 James KernThis program is free software; you can redistribute it and/ormodify it under the terms of the GNU General Public Licenseas published by the Free Software Foundation; either version 2of the License, or (at your option) any later version. This program is distributed in the hope that it will be useful,but WITHOUT ANY WARRANTY; without even the implied warranty ofMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See theGNU General Public License for more details. You should have received a copy of the GNU General Public Licensealong with this program; if not, write to the Free SoftwareFoundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.Epiware, Inc. and Praxis Inc, hereby disclaims all copyrightinterest in the program 'Epiware' writtenby James Kern, Edward Kline, Ryan Gilfether, Ray Gorospe, Patrick Waddingham06 September 2006James Kern, President of Epiware Jack Chapman, President of Praxis*****************************************************************************/ 	require_once("./module_prepend.php");//include_once("./date_handler.inc.php");$date_handler = new date_handler();      if(PROGRAM_MANAGER == 1) {       require("./role_set.php");       $role_set = new role_set($db,$user_id);     }      if($user_id == "" || $group_id == ""){          header("Location: expired.php?message=$message");          exit;      }	if($enc_group_id == "" || $enc_user_id == "")	{		header("Location: sign_out.php");		exit;	}		if((!$is_member))	{		if( (!$is_admin) && (!$is_root) && (!(PROGRAM_MANAGER == 1 && (ROLE_ID == 1 || ROLE_ID == 2 || ROLE_ID == 3 || ROLE_ID == 7) )) )		{				    header("Location: ./epi_home.php");		    exit;		}	}//do the no-cache headersinclude_once("./epi_no_cache.inc.php");//start the page hereecho "<html>";include_once("./epi_header.inc.php");echo "<body bgcolor=\"#FFFFFF\" topmargin=\"1\" leftmargin=\"0\"><div align=center>";	//end of inserted security check	$s_sql = "select sql,last_order from adv_action_sql where user_id='".$user_id."' and group_id='".$group_id."'";			if($s_result = $db->perform_looping_query($s_sql) )	{		$s_row = $db->get_next_row($s_result);				$base_sql = stripslashes($s_row["sql"]);		$base_order = stripslashes($s_row["last_order"]);		//get sql and add ordering information		$q_sql = $base_sql.$base_order;			}	else	{		$q_sql = "select ref_num,subject,status,assign_id,user_id,";		$q_sql .= "assign_date,due_date,action,action_taken from adv_action_items ";		$q_sql .= "where group_id='$group_id' order by ref_num asc";	}echo "				<table width=836 cellpadding=0 cellspacing=0 border=0 bgcolor=\"#FFFFFF\">				<tr>					<td align=left valign=top>						<a href=\"./adv_admin_action.php\" class=\"blue\"> Return to Tasks </a>					</td>					<td align=center valign=top>						<font class=\"blacksm\">						Please set the print orientation to Landscape before printing.						</font>					</td>				</tr>			</table>							<table width=836 cellpadding=1 cellspacing=0 border=1 bgcolor=\"#000000\">			<tr><td align=center valign=middle>						<table width=836 cellpadding=0 cellspacing=0 border=0 bgcolor=\"#FFFFFF\">				<tr>									<td width=85 align=center valign=top>						<font class=\"blacksm\">						Ref_Num						</font>					</td>					<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=210 align=center valign=top>						<font class=\"blacksm\">						Subject						</font>					</td>						<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=50 align=center valign=top>						<font class=\"blacksm\">						Status						</font>					</td>										<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>										<td width=125 align=center valign=top>						<font class=\"blacksm\">						Assigned To						</font>					</td>						<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=125 align=center valign=top>						<font class=\"blacksm\">						Assigned By						</font>					</td>					<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=115 align=center valign=top>						<font class=\"blacksm\">						Date Assigned					  	</font>					</td>							<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=115 align=center valign=top>						<font class=\"blacksm\">						Date Due						</font>					</td>										</tr>			</table>						<table height=1 width=836 cellpadding=0 cellspacing=0 border=0 bgcolor=$bgcolor>				<tr height=1>				 	<td height=1 bgcolor=\"#000000\"><img src=\"./images/clear.gif\" border=0 width=1 height=1></td>				</tr>			</table>			<table width=836 cellpadding=0 cellspacing=0 border=0 bgcolor=\"#FFFFFF\">				<tr>										<td width=418 align=center valign=top>						<font class=\"blacksm\">						Description						</font>					</td>					<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=417 align=center valign=top>						<font class=\"blacksm\">						Closure Action						</font>					</td>				</tr>			</table>			</td><tr></table>			<br>		  ";	$result = $db->perform_looping_query($q_sql);	$c = 0;	if($result)	{				while($row = $db->get_next_object($result))		{			if(($c%2)==0)			{			 	$bgcolor = "#CCCCCC";			}			else			{			 	$bgcolor = "#EEEEEE";			}			if( ($ref_num = htmlentities(stripslashes(trim($row->ref_num))))=="")			{			 	$ref_num = "&nbsp;";			}			if( ($subject = htmlentities(stripslashes(trim($row->subject))))=="")			{			 	$subject = "&nbsp;";			}			if( ($status = htmlentities(stripslashes(trim($row->status))))=="")			{			 	$status = "&nbsp;";			}							$to_id = $row->user_id;			$by_id = $row->assign_id;			if($users[$to_id] == "")			{				$name = "";				$usql = "select f_name,l_name from users where user_id=$to_id";				if($uresult = $db->perform_looping_query($usql))				{					if($urow = $db->get_next_row($uresult))					{						$l_name = trim($urow["l_name"]);						$f_name = substr(trim($urow["f_name"]),0,1);												if($l_name != "")						{						 	$name = $l_name;							if($f_name != "")							{							 	$name .= ", $f_name.";							}						}						else if($f_name != "")						{						 	$name = trim($urow["f_name"]);						}																	}//end of if urow					$db->free_result_set($uresult);				}//end of if result				if($name == "")				{		  			$name = "&nbsp;";				}//end of else no name entered				else				{				 	$name = htmlentities(stripslashes($name));				}				$users[$to_id] = $name;				$to = $name;			}//end of if the name is already set			else			{			 	$to = $users[$to_id];			}//end of else name already looked up			if($users[$by_id] == "")			{				$name = "";				$usql = "select f_name,l_name from users where user_id=$by_id";				if($uresult = $db->perform_looping_query($usql))				{					if($urow = $db->get_next_row($uresult))					{						$l_name = trim($urow["l_name"]);						$f_name = substr(trim($urow["f_name"]),0,1);												if($l_name != "")						{						 	$name = $l_name;							if($f_name != "")							{							 	$name .= ", $f_name.";							}						}						else if($f_name != "")						{						 	$name = trim($urow["f_name"]);						}																	}//end of if urow					$db->free_result_set($uresult);				}//end of if result				if($name == "")				{		  			$name = "&nbsp;";				}//end of else no name entered				else				{				 	$name = htmlentities(stripslashes($name));				}				$users[$by_id] = $name;				$by = $name;			}//end of if the name is already set			else			{			 	$by = $users[$by_id];			}//end of else name already looked up						$assign_date = htmlentities(stripslashes(trim($row->assign_date)));			$assign_date = $date_handler->db2system($assign_date);			$assign_date = date("M j, Y",$assign_date);			$due_date = htmlentities(stripslashes(trim($row->due_date)));			$due_date = $date_handler->db2system($due_date);			$due_date = date("M j, Y",$due_date);			$desc = htmlentities(stripslashes(trim($row->action)));			$closure = htmlentities(stripslashes(trim($row->action_taken)));			if($desc == "")			{			 	$desc = "&nbsp;";			}			if($closure == "")			{			 	$closure = "&nbsp;";			}			echo "			<table width=836 cellpadding=1 cellspacing=0 border=1 bgcolor=\"#000000\">			<tr><td align=center valign=middle>						<table width=836 cellpadding=0 cellspacing=0 border=0 bgcolor=$bgcolor>				<tr>					<td width=85 align=center valign=top>						<font class=\"blacksm\">						$ref_num						</font>					</td>					<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=210 align=center valign=top>						<font class=\"blacksm\">						$subject						</font>					</td>						<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=50 align=center valign=top>						<font class=\"blacksm\">						$status						</font>					</td>										<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>										<td width=125 align=center valign=top>						<font class=\"blacksm\">						$to						</font>					</td>						<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=125 align=center valign=top>						<font class=\"blacksm\">						$by						</font>					</td>					<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=115 align=center valign=top>						<font class=\"blacksm\">						$assign_date					  	</font>					</td>							<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=115 align=center valign=top>						<font class=\"blacksm\">						$due_date						</font>					</td>					</tr>			</table>									<table height=1 width=836 cellpadding=0 cellspacing=0 border=0 bgcolor=$bgcolor>				<tr height=1>				 	<td height=1 bgcolor=\"#000000\"><img src=\"./images/clear.gif\" border=0 width=1 height=1></td>				</tr>			</table>			<table width=836 cellpadding=0 cellspacing=0 border=0 bgcolor=$bgcolor>				<tr>										<td width=418 align=left valign=top>						<font class=\"blacksm\">						$desc						</font>					</td>					<td bgcolor=\"#000000\" width=1 align=center valign=top>						<img src=\"./images/clear.gif\" border=0 width=1 height=1>					</td>					<td width=417 align=left valign=top>						<font class=\"blacksm\">						$closure						</font>					</td>								</tr>			</table>			</td></tr></table>					  ";		  //<img src=\"./images/clear.gif\" width=10 height=1 border=0>		  $c++;		}//end of loop through results		$db->free_result_set($result);	}//end of if there are resultsecho "</div></body></html>";require_once("./epi_append.php");?>